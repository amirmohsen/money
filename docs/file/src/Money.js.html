<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Money.js | wealth</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A full-featured money library"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="wealth"><meta property="twitter:description" content="A full-featured money library"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/amirmohsen/wealth"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Currency.js~Currency.html">Currency</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/CurrencyStore.js~CurrencyStore.html">CurrencyStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Formatter.js~Formatter.html">Formatter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Money.js~Money.html">Money</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#errors">errors</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/CurrencyMismatchError.js~CurrencyMismatchError.html">CurrencyMismatchError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/InvalidCurrencyError.js~InvalidCurrencyError.html">InvalidCurrencyError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/WealthError.js~WealthError.html">WealthError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/WrongInputError.js~WrongInputError.html">WrongInputError</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Money.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import BigNumber from &apos;bignumber.js&apos;;
import isInt from &apos;validator/lib/isInt&apos;;
import isFloat from &apos;validator/lib/isFloat&apos;;
import Currency from &apos;./Currency&apos;;
import CurrencyMismatchError from &apos;./errors/CurrencyMismatchError&apos;;
import WrongInputError from &apos;./errors/WrongInputError&apos;;
import Formatter from &apos;./Formatter&apos;;

/**
 * @example
 * let price = new Money(&apos;7856&apos;, &apos;USD&apos;); // $78.56
 */
export default class Money {

	/**
	 * Rounding modes you can use in your operations.
	 * These map directly to [`BigNumber`&apos;s rounding modes](http://mikemcl.github.io/bignumber.js/#constructor-properties).
	 * @type {object} ROUNDING - rounding modes
	 * @property {number} ROUNDING.UP - Rounds away from zero
	 * @property {number} ROUNDING.DOWN - Rounds towards zero
	 * @property {number} ROUNDING.CEIL - Rounds towards Infinity
	 * @property {number} ROUNDING.FLOOR - Rounds towards -Infinity
	 * @property {number} ROUNDING.HALF_UP - Rounds towards nearest neighbour. If equidistant, rounds away from zero
	 * @property {number} ROUNDING.HALF_DOWN - Rounds towards nearest neighbour. If equidistant, rounds towards zero
	 * @property {number} ROUNDING.HALF_EVEN - Rounds towards nearest neighbour. If equidistant, rounds towards even neighbour
	 * @property {number} ROUNDING.HALF_CEIL - Rounds towards nearest neighbour. If equidistant, rounds towards Infinity
	 * @property {number} ROUNDING.HALF_FLOOR - Rounds towards nearest neighbour. If equidistant, rounds towards -Infinity
	 *
	 * @example
	 * let
	 *      price = new Money(&apos;7856&apos;, &apos;USD&apos;), // $78.56
	 *      discountedAndRoundedUp = price.multiply(&apos;0.70&apos;), // $55.00
	 *      discountedAndRoundedDown = price.multiply(&apos;0.70&apos;, Money.ROUNDING.DOWN); // $54.99
	 */
	static ROUNDING = {
		UP: BigNumber.ROUND_UP,
		DOWN: BigNumber.ROUND_DOWN,
		CEIL: BigNumber.ROUND_CEIL,
		FLOOR: BigNumber.ROUND_FLOOR,
		HALF_UP: BigNumber.ROUND_HALF_UP,
		HALF_DOWN: BigNumber.ROUND_HALF_DOWN,
		HALF_EVEN: BigNumber.ROUND_HALF_EVEN,
		HALF_CEIL: BigNumber.ROUND_HALF_CEIL,
		HALF_FLOOR: BigNumber.ROUND_HALF_FLOOR
	};

	/**
	 * @example &lt;caption&gt;Integer as value&lt;/caption&gt;
	 * let price = new Money(7856, &apos;USD&apos;); // $78.56
	 *
	 * @example &lt;caption&gt;String integer as value&lt;/caption&gt;
	 * let price = new Money(&apos;7856&apos;, &apos;USD&apos;); // $78.56
	 *
	 * @example &lt;caption&gt;String Float as value&lt;/caption&gt;
	 * let price = new Money(&apos;78.56&apos;, &apos;USD&apos;); // $78.56
	 *
	 * @example &lt;caption&gt;Money instance as value&lt;/caption&gt;
	 * let price = new Money(new Money(&apos;78.56&apos;), &apos;USD&apos;); // $78.56 - same as using clone()
	 *
	 * @example &lt;caption&gt;Currency instance as currency&lt;/caption&gt;
	 * let price = new Money(&apos;7856&apos;, new Currency(&apos;USD&apos;)); // $78.56
	 *
	 * @param {number|string|Money} value - integer, integer string, float string, instance of `Money`
	 * @param {string|Currency} currency - currency code as string, instance of `Currency`
	 */
	constructor(value, currency) {
		/**
		 * Internal currency
		 * @type {Currency} - Internal Currency instance
		 * @private
		 */
		this._currency = new Currency(currency);

		/**
		 * BigNumber constructor used by this &quot;Money&quot; instance
		 * @type {class}
		 * @private
		 */
		this._bigNumberConstructor = this._getBigNumberConstructor();

		/**
		 * Internal value as a big number
		 * @type {BigNumber} - Internal BigNumber instance holding the value
		 * @private
		 */
		this._value = this._preProcessInputValue(value, this._bigNumberConstructor);
	}

	/**
	 * Performs addition
	 * @param {number|string|Money} value - value to be added to the current value; type same as constructor
	 * @returns {Money} - new Money instance after addition
	 */
	add(value) {
		value = new this.constructor(value, this._currency);
		let newValue = this._value.plus(value.getAmountAsBigNumber());
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Performs subtraction
	 * @param {number|string|Money} value - value to be subtracted from the current value; type same as constructor
	 * @returns {Money} - new Money instance after subtraction
	 */
	subtract(value) {
		value = new this.constructor(value, this._currency);
		let newValue = this._value.minus(value.getAmountAsBigNumber());
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Performs multiplication
	 * @param {number|string} value - value to multiply the current value
	 * @param {number} [rounding=ROUNDING.HALF_UP] - rounding mode used in this operation; has to be one of the rounding modes in `Money.ROUNDING`
	 * @returns {Money} - new Money instance after multiplication
	 */
	multiply(value, rounding = this.constructor.ROUNDING.HALF_UP) {
		let newValue = this._value.times(value).decimalPlaces(this._currency.getDecimalDigits(), rounding);
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Performs division
	 * @param {number|string} value - value to divide the current value by
	 * @param {number} [rounding=ROUNDING.HALF_UP] - rounding mode used in this operation; has to be one of the rounding modes in `Money.ROUNDING`
	 * @returns {Money} - new Money instance after division
	 */
	divide(value, rounding = this.constructor.ROUNDING.HALF_UP) {
		let newValue = this._value.dividedBy(value).decimalPlaces(this._currency.getDecimalDigits(), rounding);
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Performs an equality check
	 * @param {number|string|Money} value - value to compare to the current value; type same as constructor
	 * @returns {boolean} - true if value is considered equal to the current value
	 */
	equals(value) {
		value = new this.constructor(value, this._currency);
		return this._value.isEqualTo(value.getAmountAsBigNumber());
	}

	/**
	 * Performs a check if the current value is greater than the parameter
	 * @param {number|string|Money} value - value to compare to the current value; type same as constructor
	 * @returns {boolean} - true if the current value is greater than the parameter
	 */
	greaterThan(value) {
		value = new this.constructor(value, this._currency);
		return this._value.isGreaterThan(value.getAmountAsBigNumber());
	}

	/**
	 * Performs a check if the current value is greater than or equal to the parameter
	 * @param {number|string|Money} value - value to compare to the current value; type same as constructor
	 * @returns {boolean} - true if the current value is greater than or equal to the parameter
	 */
	greaterThanOrEqualTo(value) {
		value = new this.constructor(value, this._currency);
		return this._value.isGreaterThanOrEqualTo(value.getAmountAsBigNumber());
	}

	/**
	 * Performs a check if the current value is less than the parameter
	 * @param {number|string|Money} value - value to compare to the current value; type same as constructor
	 * @returns {boolean} - true if the current value is less than the parameter
	 */
	lessThan(value) {
		value = new this.constructor(value, this._currency);
		return this._value.isLessThan(value.getAmountAsBigNumber());
	}

	/**
	 * Performs a check if the current value is less than or equal to the parameter
	 * @param {number|string|Money} value - value to compare to the current value; type same as constructor
	 * @returns {boolean} - true if the current value is less than or equal to the parameter
	 */
	lessThanOrEqualTo(value) {
		value = new this.constructor(value, this._currency);
		return this._value.isLessThanOrEqualTo(value.getAmountAsBigNumber());
	}

	/**
	 * Return the absolute monetary value of the current value, i.e., remove the minus sign if the value is below zero
	 * @returns {Money} - new Money instance with the absolute value
	 */
	absolute() {
		let newValue = this._value.absoluteValue();
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Return the largest integer less than or equal to the current value
	 * @returns {Money} - new Money instance with the floor value
	 */
	floor() {
		let newValue = this._value.decimalPlaces(0, this.constructor.ROUNDING.FLOOR);
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Return the smallest integer greater than or equal to the current value
	 * @returns {Money} - new Money instance with the ceiling value
	 */
	ceil() {
		let newValue = this._value.decimalPlaces(0, this.constructor.ROUNDING.CEIL);
		return new this.constructor(this._convertBigNumberToStringInteger(newValue), this._currency);
	}

	/**
	 * Checks if the current currency is the same as that of the parameter
	 * @param {Money} value - value to check currency against the current value; type same as constructor
	 * @returns {boolean} - true if the current value has the same currency as the parameter
	 */
	hasSameCurrency(value) {
		if(!(value instanceof Money)) {
			throw new WrongInputError(&apos;The input value must be a &quot;Money&quot; instance.&apos;);
		}
		return this._currency.is(value.getCurrency());
	}

	/**
	 * Split the current value by an array of ratios
	 * @param {number[]|string[]} ratios - an array of numbers by which to divide up the current value
	 * @returns {Money[]} - an array of new Money instances, resulting from splitting the current value
	 */
	allocate(ratios) {
		let
			allocations = [],
			totalValue = this.clone(),
			remainder = this.clone(),
			total = ratios.reduce((total, ratio) =&gt; total.plus(ratio), new BigNumber(&apos;0&apos;));

		for(let ratio of ratios) {
			let share = totalValue
				.multiply(ratio, this.constructor.ROUNDING.FLOOR)
				.divide(total, this.constructor.ROUNDING.FLOOR);

			allocations.push(share);
			remainder = remainder.subtract(share);
		}

		return this._addRemainderToAllocations(allocations, remainder);
	}

	/**
	 * Split the current value by the count
	 * @param {number|string} count - count by which to allocate the current value (must be a 1+ integer)
	 * @returns {Money[]} - an array of new Money instances, resulting from splitting the current value
	 */
	allocateTo(count) {
		let
			allocations = [],
			totalValue = this.clone(),
			baseShare = totalValue.divide(count, this.constructor.ROUNDING.FLOOR),
			remainder = totalValue.subtract(baseShare.multiply(count, this.constructor.ROUNDING.FLOOR));

		for(let i = 0; i &lt; count; i++) {
			allocations.push(baseShare.clone());
		}

		return this._addRemainderToAllocations(allocations, remainder);
	}

	/**
	 * Create a new money instance, holding an identical value and currency to the current one
	 * @returns {Money} - the cloned money instance
	 */
	clone() {
		return new this.constructor(this.getAmount(), this._currency);
	}

	/**
	 * Format the current value based on the currency
	 * @param {object} [settings] - formatting settings
	 * @returns {string} - formatted money
	 */
	format(settings = {}) {
		return this._currency.format(this, settings);
	}

	/**
	 * Get the current value as an instance of BigNumber
	 * @returns {BigNumber} - Internal BigNumber representation of the current value
	 */
	getAmountAsBigNumber() {
		return this._value;
	}

	/**
	 * Get the current value as a string integer (same as `getAmount`)
	 * @returns {string} - String integer representation of the current value
	 */
	getAmountAsStringInteger() {
		return this.getAmount();
	}

	/**
	 * Get the current value as a string float
	 * @returns {string} - String float representation of the current value
	 */
	getAmountAsStringFloat() {
		return this._value.toString();
	}

	/**
	 * Get the current value as a string integer (same as `getAmountAsStringInteger`)
	 * @returns {string} - String integer representation of the current value
	 */
	getAmount() {
		return this._convertBigNumberToStringInteger(this._value);
	}

	/**
	 * Get the current value as a string integer (same as `getAmount`)
	 * @returns {string} - String integer representation of the current value
	 */
	toString() {
		return this.getAmount();
	}

	/**
	 * Get the internal Currency instance
	 * @returns {Currency} - Internal Currency instance
	 */
	getCurrency() {
		return this._currency;
	}

	/**
	 * Get the smallest unit of the current monetary value, i.e., 0.01 (aka penny) in a USD money
	 * @returns {Money} - new Money instance holding the smallest unit of the current monetary value
	 */
	getSmallestUnit() {
		return new this.constructor(this._getSmallestUnitAsBigNumber().toString(), this._currency);
	}

	/**
	 * Get BigNumber constructor used by this &quot;Money&quot; instance
	 * @returns {class}
	 */
	getBigNumberConstructor() {
		return this._bigNumberConstructor;
	}

	/**
	 * Get a simple object representing the current monetary value
	 * @returns {{amount: string, currency: string}} - object with a string integer value and currency code
	 */
	toJSON() {
		return {
			amount: this.getAmount(),
			currency: this._currency.toJSON()
		};
	}

	/**
	 * Check that the currency of the passed value matches the current currency. If not, throw an error.
	 * @param {Money} value - The money object which is used for currency check
	 * @private
	 */
	_checkValueCurrency(value) {
		if(!this.hasSameCurrency(value)) {
			throw new CurrencyMismatchError();
		}
	}

	/**
	 * Used by allocation methods to add the remainder to the array of allocations
	 * @param {Money[]} allocations - an array of Money instances already allocated
	 * @param {Money} remainder - a Money instance with the remainder yet to be added to the array of allocations
	 * @returns {Money[]} - the final allocations array of Money instances
	 * @private
	 */
	_addRemainderToAllocations(allocations, remainder) {
		let
			i = 0,
			noMoney = new this.constructor(&apos;0&apos;, this._currency),
			smallestUnit = this.getSmallestUnit();

		while(!remainder.equals(noMoney)) {
			allocations[i] = allocations[i].add(smallestUnit);
			remainder = remainder.subtract(smallestUnit);

			i++;

			if(i === allocations.length) {
				i = 0;
			}
		}

		return allocations;
	}

	/**
	 * Convert the constructor input value to an internal BigNumber instance
	 * @param {number|string|Money} value - integer, integer string, float string, instance of `Money`
	 * @param {class} BN - BigNumber constructor used by this &quot;Money&quot; instance
	 * @returns {BigNumber} - Internal BigNumber instance
	 * @private
	 */
	_preProcessInputValue(value, BN) {
		if(value instanceof Money) {
			this._checkValueCurrency(value);
			return value.getAmountAsBigNumber();
		}

		let divisor = this._getSmallestUnitDivisor();

		if(divisor.isGreaterThan(1) &amp;&amp; (Number.isInteger(value) || (typeof value === &apos;string&apos; &amp;&amp; isInt(value)))) {
			value = new BN(value);

			return value
				.dividedBy(divisor)
				.decimalPlaces(this._currency.getDecimalDigits());
		}

		if(typeof value === &apos;string&apos; &amp;&amp; isFloat(value)) {
			return new BN(value);
		}

		throw new WrongInputError(&apos;The input value must be either an integer, an integer-like string, a float-like string or a &quot;Money&quot; instance.&apos;);
	}

	/**
	 * Get the smallest unit divisor for the current value&apos;s currency, i.e., 10 to the power of the currency&apos;s decimal digits.
	 * It is used for converting an integer value to a float value (or vice versa).
	 * @returns {BigNumber} - Smallest unit divisor
	 * @private
	 */
	_getSmallestUnitDivisor() {
		let	decimalDigits = this._currency.getDecimalDigits();
		return (new BigNumber(&apos;10&apos;)).exponentiatedBy(decimalDigits);
	}

	/**
	 * Get the smallest unit of the currency as a big number
	 * @returns {BigNumber} - Smallest unit of the currency
	 * @private
	 */
	_getSmallestUnitAsBigNumber() {
		return (new BigNumber(&apos;1&apos;)).dividedBy(this._getSmallestUnitDivisor());
	}

	/**
	 * Convert a BigNumber to a string integer
	 * @param {BigNumber} value - value to be converted
	 * @returns {string} - String integer value of the BigNumber value
	 * @private
	 */
	_convertBigNumberToStringInteger(value) {
		return value.times(this._getSmallestUnitDivisor()).toString();
	}

	/**
	 * The values below are the default but we need a new constructor in case the default is changed by external code.
	 * @returns {object} - BigInteger constructor with 20 decimal places and default rounding half up
	 * @private
	 */
	_getBigNumberConstructor() {
		return BigNumber.clone({
			DECIMAL_PLACES: 20,
			ROUNDING_MODE: this.constructor.ROUNDING.HALF_UP,
			FORMAT: {
				decimalSeparator: this._currency.getDecimalSeparator(),
				groupSeparator: this._currency.getThousandsSeparator(),
				groupSize: 3,
				secondaryGroupSize: 0,
				fractionGroupSeparator: &apos; &apos;,
				fractionGroupSize: 0
			}
		});
	}

	/**
	 * Parse a formatted money string into an instance of Money
	 * @param {string} value - the formatted money string
	 * @param {string|object|Currency} settings - the formatting settings
	 * @returns {Money} - a Money instance holding the parsed value and currency
	 */
	static parse(value, settings) {
		return Formatter.parse(value, settings);
	}
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
