<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Formatter.js | wealth</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A full-featured money library"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="wealth"><meta property="twitter:description" content="A full-featured money library"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/amirmohsen/wealth"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Currency.js~Currency.html">Currency</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/CurrencyStore.js~CurrencyStore.html">CurrencyStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Formatter.js~Formatter.html">Formatter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Money.js~Money.html">Money</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#errors">errors</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/CurrencyMismatchError.js~CurrencyMismatchError.html">CurrencyMismatchError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/InvalidCurrencyError.js~InvalidCurrencyError.html">InvalidCurrencyError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/WealthError.js~WealthError.html">WealthError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/errors/WrongInputError.js~WrongInputError.html">WrongInputError</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Formatter.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import InvalidCurrencyError from &apos;./errors/InvalidCurrencyError&apos;;
import CurrencyStore from &apos;./CurrencyStore&apos;;
import Money from &apos;./Money&apos;;
import Currency from &apos;./Currency&apos;;

/**
 * @example &lt;caption&gt;Format value based on internal currency&lt;/caption&gt;
 * Formatter.format(value);
 *
 * @example &lt;caption&gt;Format value based on currency parameter&lt;/caption&gt;
 * Formatter.format(value, new Currency(&apos;USD&apos;));
 *
 * @example &lt;caption&gt;Format value based on currency code&lt;/caption&gt;
 * Formatter.format(value, &apos;USD&apos;);
 *
 * @example &lt;caption&gt;Format value based on custom settings&lt;/caption&gt;
 * Formatter.format(value, {
 *  code: &apos;EUR&apos;,
 *  pattern: &apos;%s%v&apos;
 * });
 */
export default class Formatter {

	/**
	 * Format money based on settings
	 * @param {Money} value - Monetary value to be formatted
	 * @param {object|string|Currency} [settings] - Formatting settings, currency code or currency
	 * @returns {string} - Formatted money string
	 */
	static format(value, settings) {
		const
			details = this._getFormattingDetails(value, settings),
			{
				symbol,
				code,
				decimalDigits,
				pattern,
				formatter
			} = details;

		if(typeof formatter === &apos;function&apos;) {
			return formatter(value, details);
		}

		let
			formattedValue = details.value.absoluteValue().toFormat(decimalDigits),
			formatted = pattern.replace(&apos;%v&apos;, formattedValue);

		formatted = formatted.replace(&apos;%ns&apos;, details.value.isNegative() ? &apos;-&apos; : &apos;&apos;);

		formatted = formatted.replace(&apos;%i&apos;, details.value.isInteger() ? details.value.toFormat(0) : formattedValue);

		if(symbol) {
			formatted = formatted.replace(&apos;%s&apos;, symbol);
		}

		if(code) {
			formatted = formatted.replace(&apos;%c&apos;, code);
		}

		return formatted;
	}

	/**
	 * Parse money based on settings
	 * @param {string} value - Monetary value to be parsed
	 * @param {object|string|Currency} settings - Parsing settings, currency code or currency
	 * @returns {Money} - Parsed &quot;Money&quot; value
	 */
	static parse(value, settings) {
		let
			options = this._getOptions(settings),
			{
				symbol,
				code,
				thousandsSeparator,
				decimalSeparator,
				parser
			} = options;

		if(typeof parser === &apos;function&apos;) {
			return parser(value, options);
		}

		value = this._replaceAll(value, thousandsSeparator, &apos;&apos;);
		value = this._replaceAll(value, symbol, &apos;&apos;);
		value = this._replaceAll(value, code, &apos;&apos;);
		value = this._replaceAll(value, decimalSeparator, &apos;&apos;);
		value =	value.replace(/\s/g, &apos;&apos;);

		return new Money(value, code);
	}

	/**
	 * Replace all case-insensitive instances of a string in another string
	 * @param {string} source - source string
	 * @param {string} search - search string
	 * @param {string} replacement - replacement string
	 * @returns {string} - final string result
	 * @private
	 */
	static _replaceAll(source, search, replacement) {
		let
			esc = search.replace(/[-\/\\^$*+?.()|[\]{}]/g, &apos;\\$&amp;&apos;),
			reg = new RegExp(esc, &apos;ig&apos;);
		return source.replace(reg, replacement);
	}

	/**
	 * Get formatting details
	 * @param {Money} value - Monetary value to be formatted
	 * @param {object|string|Currency} [settings] - Formatting settings, currency code or currency
	 * @returns {{symbol: string, code: string, value: BigNumber, decimalDigits: number, pattern: string}} - Formatting details
	 * @private
	 */
	static _getFormattingDetails(value, settings) {
		let {
			symbol,
			code,
			thousandsSeparator,
			decimalSeparator,
			decimalDigits,
			pattern,
			formatter
		} = this._getOptions(settings, value);

		if(settings === undefined || (settings instanceof Currency &amp;&amp; value.getCurrency().is(settings))) {
			value = value.getAmountAsBigNumber();
		}
		else {
			const BN = value.getBigNumberConstructor().clone({
				FORMAT: {
					decimalSeparator,
					groupSeparator: thousandsSeparator,
					groupSize: 3,
					secondaryGroupSize: 0,
					fractionGroupSeparator: &apos; &apos;,
					fractionGroupSize: 0
				}
			});

			value = new BN(value);
		}

		return {
			symbol,
			code,
			value,
			decimalDigits,
			pattern,
			formatter
		};
	}

	/**
	 * Get formatting/parsing options
	 * @param {object|string|Currency} [settings] - Formatting settings, currency code or currency
	 * @param {Money} [value] - Monetary value to be formatted
	 * @returns {{symbol: string, code: string, thousandsSeparator: string, decimalSeparator: string, decimalDigits: number, pattern: string}} - Formatting/parsing details
	 * @private
	 */
	static _getOptions(settings, value = null) {
		if(settings === undefined &amp;&amp; value instanceof Money) {
			return value.getCurrency().getSettings();
		}

		if(typeof settings === &apos;string&apos;) {
			settings = settings.toUpperCase();

			if(!CurrencyStore.has(settings)) {
				throw new InvalidCurrencyError(`No currency with code &quot;${settings}&quot; is registered.`);
			}

			return CurrencyStore.get(settings);
		}

		if(settings instanceof Currency) {
			return settings.getSettings();
		}

		if(typeof settings !== &apos;object&apos;) {
			throw new InvalidCurrencyError(&apos;Invalid currency options provided.&apos;);
		}

		if(typeof settings.code !== &apos;string&apos; || !settings.code) {
			throw new InvalidCurrencyError(&apos;Invalid currency settings; code is required.&apos;);
		}

		if(CurrencyStore.has(settings.code)) {
			settings = {
				...CurrencyStore.get(settings.code),
				...settings
			};
		}

		return {
			thousandsSeparator: &apos;,&apos;,
			decimalSeparator: &apos;.&apos;,
			decimalDigits: 2,
			pattern: &apos;%s%ns%v&apos;,
			formatter: null,
			parser: null,
			symbol: settings.code,
			...settings,
		};
	}
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
